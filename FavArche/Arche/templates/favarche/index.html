{% extends 'favarche/base.html' %}

{% block content %}
{% load static %}
{% load multifor %}
	
	<div id="main-div">
		<div id="page_main_div">
			<div id="side_menu">
				<div id="side_menu_div1">
					<h4 id="side_menu_title">Explore</h4>
				</div>
				<div id="side_menu_div2">
					<ul id="explore_menu">
						<li id="explore_menu_link" class="tooltip-bottom" data-tooltip="Contactez-nous">
							<a id="explore_link_color" href="{% url 'contact' %}">
								Contact
							</a>
						</li>
						<li id="explore_menu_link" class="tooltip-bottom" data-tooltip="A Propos de Nous">
							<a id="explore_link_color" href="{% url 'about_us' %}">
								A Propos
							</a>
						</li>
						<li id="explore_menu_link" class="tooltip-bottom" data-tooltip="Découvrez quoi faire!">
							<a id="explore_link_color" href="{% url 'functionality' %}">
							 	Fonctionnalités
							</a>
						</li>
						<li id="explore_menu_link" class="tooltip-bottom" data-tooltip="Liste des categories">
							<a id="explore_link_color" href="{% url 'category' %}">
							 	Catégories
							</a>
						</li>
					</ul>
				</div>
			</div>
			<div id="middle_div">
				{% if works|length == 0 %}
				<div id="work_div_index">
					<h1>Il n'existe aucune oeuvre pour le moment</h1>
				</div>
				{% else %}
					{% for work in works; image in user_image; comments in comment_list %}
							<div id="work_div_index">
								<a href="{% url 'other_accounts' work.user.username %}" id="link_color">
									<img  id="user_img" src="{{image.image.url}}">
									<p id="user_name">{{ work.user }}</p>
								</a>
								<p>{{ work.name }}</p>
								<a href="{% url 'work_details' work.name %}">
									<img id="work_img" src="/media/{{ work.image }}">
								</a>
								<div>
									{% for comment in comments %}
										<p>{{ comment.content }}</p>
									{% endfor %}
								</div>
								<div id="comment_form">
									<textarea placeholder="Commentez-ici" id="comment{{work.id}}"></textarea>
									<button id="btn_comment{{work.id}}" type="submit" onclick="send_comment_data({{work.id}})">Commenter</button>
								</div>
							</div>
							{% ifequal forloop.counter|divisibleby:"1" True %}
								<br>
							{% endifequal %}
						{% endfor %}
				{% endif %}
			</div>
			<div id="social_menu">
				{% for user_account in users; img in social_user_img %}
					<div id="social_user_div">
						{% if user_account.username != user.username %}
							<p>
								<img id="social_user_img" src="{{img.image.url}}">
								{{ user_account.username }}
							</p>
						{% endif %}
					</div>
				{% endfor %}
			</div>
		</div>
	</div>

<script type="text/javascript">

	function getCookie(name) {
	    let cookieValue = null;
	    if (document.cookie && document.cookie !== '') {
	        const cookies = document.cookie.split(';');
	        for (let i = 0; i < cookies.length; i++) {
	            const cookie = cookies[i].trim();
	            // Does this cookie string begin with the name we want?
	            if (cookie.substring(0, name.length + 1) === (name + '=')) {
	                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
	                break;
	            }
	        }
	    }
	    return cookieValue;
	}

	function send_comment_data(work_id){

			var comment = document.getElementById("comment" + work_id);
			
            var fav_data = {
                "work_id": work_id,
                "comment": comment.value
            };

             $.ajax({
                url: "{% url 'home' %}",
                type: "POST",
                data: fav_data,
                headers: {'X-CSRFToken': getCookie('csrftoken')},
                success: function(data){
                    if (data == "OK"){
                    	document. location.reload();
                    } else{
                        console.log("siniem");
                    }}
                
            })

        }

</script>

{% endblock %}
